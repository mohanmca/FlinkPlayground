## 1. Task Failure Recovery (Big Picture)

* When a **task failure** happens, Flink must **restart the failed task and other affected tasks** to bring the job back to a normal state.
* Two mechanisms control this:

  * **Restart strategies** → *whether and when* restarts happen
  * **Failover strategies** → *which tasks* are restarted

---

## 2. Restart Strategies – Overview

### Defaults & Precedence

* A **cluster-level default restart strategy** is defined in `flink-conf.yaml`.
* A **job-specific restart strategy**, if defined, **overrides** the cluster default.
* Key config:
  `restart-strategy.type`

### Default behavior

* **Checkpointing disabled** → default is **no restart**
* **Checkpointing enabled** and no strategy specified → **exponential-delay restart strategy** with default exponential-delay settings

### Supported values for `restart-strategy.type`

* `disable | off | none` → No restart
* `fixed-delay`
* `failure-rate`
* `exponential-delay`

Each strategy has **its own configuration parameters**, also set via config file or programmatically.

---

## 3. Fixed Delay Restart Strategy

### Behavior

* Retries job execution a **fixed number of times**
* Waits a **fixed delay** between retries
* If attempts exceed the limit → job fails

### Config

* `restart-strategy.type: fixed-delay`
* `restart-strategy.fixed-delay.attempts` (default: 1)
* `restart-strategy.fixed-delay.delay` (default: 1s)

### Purpose

* Useful when interacting with **external systems** that need timeouts to expire before retry.

---

## 4. Exponential Delay Restart Strategy

### Behavior

* Delay **increases exponentially** between retries
* Delay grows until it reaches `max-backoff`, then stays there
* If the job runs **successfully for a configured duration**, delay resets to the initial value

### Key configs

* `restart-strategy.exponential-delay.initial-backoff` (default: 1s)
* `restart-strategy.exponential-delay.max-backoff` (default: 1 min)
* `restart-strategy.exponential-delay.backoff-multiplier` (default: 1.5)
* `restart-strategy.exponential-delay.jitter-factor` (default: 0.1)
* `restart-strategy.exponential-delay.reset-backoff-threshold` (default: 1h)
* `restart-strategy.exponential-delay.attempts-before-reset-backoff` (default: infinite)

### Jitter

* Adds or subtracts a **random fraction** of the delay
* Prevents **multiple jobs restarting simultaneously**
* **Recommended for production**

### Example behavior

* Delay sequence grows like:
  `1s → 2s → 4s → 8s → max-backoff`
* Once max-backoff reached, delay stays constant
* If job runs without failure longer than `reset-backoff-threshold`, delay resets to initial value

---

## 5. Failure Rate Restart Strategy

### Behavior

* Restarts job after failures
* Tracks **failures per time window**
* If failures exceed limit → job fails
* Delay between retries is **fixed**

### Config

* `restart-strategy.type: failure-rate`
* `restart-strategy.failure-rate.max-failures-per-interval` (default: 1)
* `restart-strategy.failure-rate.failure-rate-interval` (default: 1 min)
* `restart-strategy.failure-rate.delay` (default: 1s)

### Use case

* Suitable when failures should be tolerated **only up to a certain rate**

---

## 6. No Restart Strategy

### Behavior

* Job **fails immediately**
* **No restart attempts**

### Config

* `restart-strategy.type: none`

---

## 7. Fallback Restart Strategy

* Uses the **cluster-defined restart strategy**
* Commonly used for streaming jobs with checkpointing
* If nothing else is specified → exponential-delay is used by default

---

## 8. Why Exponential Delay Is the Default (Important Rationale)

* All restart strategies add delay to reduce pressure on external systems
* Fixed delays have tradeoffs:

  * **Too short** → can overload external systems (avalanche effect)
  * **Too long** → reduces job availability
* Exponential delay:

  * Retries **quickly for rare failures**
  * Backs off **aggressively for frequent failures**
  * Reduces risk of **cascading failures**
  * Jitter ensures jobs don’t restart at the same time

---

## 9. Failover Strategies – Overview

Configured via:

```
jobmanager.execution.failover-strategy
```

### Supported strategies

| Strategy                 | Value    |
| ------------------------ | -------- |
| Restart all              | `full`   |
| Restart pipelined region | `region` |

---

## 10. Restart All Failover Strategy

* **All tasks in the job** are restarted after any task failure
* Simple but potentially expensive

---

## 11. Restart Pipelined Region Failover Strategy

### Core idea

* Tasks are grouped into **regions**
* A **region** = tasks connected by **pipelined data exchanges**
* **Batch exchanges define region boundaries**

### Restart rules

1. Restart the **region containing the failed task**
2. If a required result partition is unavailable:

   * Restart the **producer region**
3. If a region is restarted:

   * **All its consumer regions** are also restarted
   * Ensures **data consistency** (important for nondeterministic processing)

### Execution modes

* **Streaming mode** → pipelined by default
* **Batch mode** → batched by default
* Applies to DataStream / Table / SQL jobs

---

### One-line mental model

> **Restart strategy = when & how often**
> **Failover strategy = how much of the job**